<div class="wrapper">
  <div class="container">
    <div class="row">                
      <div class="span12">
        <div class="content">         
				  <div class="module">
					  <div class="module-head">
              <h3> <%= @workgroup.name.upcase %> </h3>
              <div class="pull-right" >
                <label style="font-weight:normal;margin-top:-20px" class = "pull-right" >
                <a href="/workgroups"><i class="icon-circle-arrow-left"> All Workgroups</i></a> </label>                
              </div>    
            </div>
            <div class="module-body">  
              <h5>Workgroup Group Admin : <%= @admin.full_name %></h5>
              <% if current_user.employee.id == @workgroup.admin_id || WorkgroupsEmployee.where(is_moderator: true,employee_id: current_user.employee.id, workgroup_id: @workgroup.id ).present?%>
              <label style="font-weight:normal;margin-top:-20px" class = "pull-right" ><a><i class="icon-plus-sign "></i></a><%= link_to " Add/Remove Moderator ",add_moderator_workgroup_path %> </label> 
              <label style="font-weight:normal;margin-top:-20px" class = "pull-right" ><a><i class="icon-user"></i></a>
                <a href="#myModal" role="button" data-toggle="modal">Add Member&nbsp;</a>
              </label> <br>                           
              <% end %>                          

             <%= hidden_field_tag('work_group_id', @workgroup.id) %>                                                      
             <% if @employees.present? %>                                                                                         
            <table class="table table-striped table-bordered table-condensed">
	            <thead>
		            <tr>
			            <th class="center">Employee Name</th>
			            <th>Role </th>
			            <th> Actions </th>        
			          </tr>
	            </thead>
	             <% @employees.each do |em| %> 
	            <tbody>
	            <tr>
			            <th class="center">
			             <%= em.full_name %> 
			            </th>           
			            <th class="center">
			              <% if em.id == @workgroup.admin_id %> 
			                Admin  
			              <% elsif WorkgroupsEmployee.where(is_moderator: true, employee_id: em.id, workgroup_id: @workgroup.id).present? %>
			                Moderator
			              <% else %>
			                Member    
			              <% end %>
			            </th>
			            <th>
			             <% if current_user.employee.id == @workgroup.admin_id  %>
			              <%= link_to "Delete",destroy_member_workgroup_path(@workgroup.id,em.id), method: :delete, data: {confirm: "Are You sure?"}, :class=>"btn btn-danger "%>
			            <% end %>
			            </th>
			        </tr>
              <% end %>
			           <% else %>  
						    <div class="alert alert-success alert-dismissable">
                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        No members/moderators to display
                  </div>                                    
						    <% end %>
		            </tbody>    
	            </table>                                                    
            </div><!--module body-->
          </div><!--/.module -->
        </div><!--/.content-->
      </div><!--/.span12-->
    </div><!--/.row-->
  </div><!--/.container-->
</div><!--/.wrapper--> 

<!-- Button to trigger modal -->
 
<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Add New Member to Workgroup</h3>
  </div><p class="flash-notice"><%# flash[:notice] %></p>
  <div class="modal-body">
    <%= render "workgroups/add_member"%>
					
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true"></button>
    <button class="btn btn-primary"></button>
  </div>
</div>      
 
<script>
  $(function() {
  var availableTags = [];
  var workgroup_id = parseInt($("#work_group_id").val());
  $.get( "/workgroups/"+workgroup_id+"/get_employees.json", function( data ) {
      $.each( data, function( key, val ) {
       availableTags.push(val);
       
       //alert(val["id"]+" - "+val["value"]);
      });
      console.log(availableTags);
  });
  
       $( "#member" ).autocomplete({
        minLength: 2,
        source: availableTags,
        focus: function( event, ui ) {
        $( "#member" ).val( ui.item.value );
        
        return false;
        },
        select: function( event, ui ) {
        $( "#member" ).val( ui.item.value );
        $( "#member_id" ).val( ui.item.id );
        return false;
        }
        })
  });
  </script>
  
  <style>
    .ui-autocomplete{
      z-index :5000;
    }
  </style>
  

                     
