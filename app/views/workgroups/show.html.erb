<div class="panel panel-info">
  <div class="panel-heading"> 
    <%= @workgroup.name.upcase %> 
    <i class="fa fa-plus pull-right" style="margin-top:3px;"></i><%= link_to 'All Workgroups', workgroups_path, :class => "pull-right" %>

  </div>                          
  <div class="panel-body">  
    <p>Workgroup Group Admin : <%= @admin.full_name %></p>
    <% if current_user.employee.id == @workgroup.admin_id || WorkgroupsEmployee.where(is_moderator: true,employee_id: current_user.employee.id, workgroup_id: @workgroup.id ).present?%>
      <span class="pull-right">
        <%# link_to "Add Member",add_members_workgroup_path,:class => "btn btn-success btn-xs"%>
        
        <%= link_to 'Add Member', "#member",  :class => "btn btn-success btn-xs add_member", :url => add_members_workgroup_path, "data-toggle" => "modal"  %> 
        
        <%= link_to "Add/Remove Moderator",add_moderator_workgroup_path, :class =>" btn btn-success btn-xs" %>                         
    <% end %> 
      </span>                         

   <%= hidden_field_tag('work_group_id', @workgroup.id) %> 
   <div class="adv-table">
      <% if @employees.present? %>      
      <table  class="display table table-bordered table-striped table-dynamic" id="dynamic-table">
        <thead>
          <tr>
            <th class="center">Employee Name</th>
            <th>Role </th>
            <th> Actions </th>        
          </tr>
        </thead>         
        <tbody>
          <% @employees.each do |em| %> 
          <tr class="gradeA">
            <th class="center">
             <%= em.full_name %> 
            </th>           
            <th class="center">
              <% if em.id == @workgroup.admin_id %> 
                Admin  
              <% elsif WorkgroupsEmployee.where(is_moderator: true, employee_id: em.id, workgroup_id: @workgroup.id).present? %>
                Moderator
              <% else %>
                Member    
              <% end %>
            </th>
            <th>
              <% if current_user.employee.id == @workgroup.admin_id %> 
                <%= link_to "Delete",destroy_member_workgroup_path(@workgroup.id,em.id), method: :delete, data: {confirm: "Are You sure?"}, :class=>"btn btn-danger "%>
                <% elsif WorkgroupsEmployee.where(is_moderator: true, employee_id: current_user.employee.id, workgroup_id: @workgroup.id).present? %>
                  <% unless em.id == current_user.employee.id %>
                    <%= link_to "Delete",destroy_member_workgroup_path(@workgroup.id,em.id), method: :delete, data: {confirm: "Are You sure?"}, :class=>"btn btn-danger "%>
                  <% end %>
            <% end %>
            </th>
          </tr>
          <% end %>
        </tbody>
      </table>    
      <% else %>    
       <div class="alert alert-success alert-dismissable">
          <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
              No members/moderators to display
        </div>                                    
      <% end %>                                                                   
      </div><!--module-body -->    																																											                               
        </div><!-- /.module-->									      				                                      
      </section><!--/.content-->                    
    </div><!--/.col-sm-12-->                
  </div><!--/.row-->
</div><!--/panel panel-info-->


<!-- Button to trigger modal -->
 
<!-- Modal -->
<div id="member" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
    <h3 id="myModalLabel">Add New Member to Workgroup</h3>
  </div><p class="flash-notice"><%# flash[:notice] %></p>
  <div class="modal-body">
    <%= render "workgroups/add_member"%>					
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true"></button>
    <button class="btn btn-primary"></button>
  </div>
</div> 

   
 
<script>
  $(function() {
  var availableTags = [];
  var workgroup_id = parseInt($("#work_group_id").val());
  $.get( "/workgroups/"+workgroup_id+"/get_employees.json", function( data ) {
      $.each( data, function( key, val ) {
       availableTags.push(val);
       
       //alert(val["id"]+" - "+val["value"]);
      });
      console.log(availableTags);
  });
  
       $( "#member" ).autocomplete({
        minLength: 2,
        source: availableTags,
        focus: function( event, ui ) {
        $( "#member" ).val( ui.item.value );
        
        return false;
        },
        select: function( event, ui ) {
        $( "#member" ).val( ui.item.value );
        $( "#member_id" ).val( ui.item.id );
        return false;
        }
        })
  });
  </script>
  
  <style>
    .ui-autocomplete{
      z-index :5000;
    }
  </style>
  
  <script>
  $(function(){
    $(".add_member").click(function(){
      var url = $(this).attr("url");
      $.ajax({
        type : "GET",
        url : url,
        dataType : "script"
      });
    });
  });
</script>

                     
