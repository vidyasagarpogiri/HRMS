<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-info">
      <div class="panel-heading">
        Attachment Info
      </div>
      <div class="panel-body">	
        <%= form_for(:employee, :url => attachment_create_employee_path(@employee), :html => {:multipart => true, :class=>"form-horizontal new_attachment_form"}, :remote => true, method: :post) do |f| %> 
          <%= fields_for :employee_attachments do |f| %>        

            <div class="form-group">
              <label class="control-label col-lg-2" for="basicinput"> Attachment Title:</label>
              <div class="col-lg-10">
<%= f.text_field :attachment_name, :class => "form-control", name: "employee_attachments[attachment_name][]",:placeholder =>"Enter Attachment Title", :data => {:error => " Please Enter valid Attachment Title"}, :required =>true %> 
              <div class="help-block with-errors"></div>  
            </div>		

            <div class="form-group">
              <label class="control-label col-lg-2" for="basicinput"> Attachment:</label>
              <div class="col-lg-10">
                <%= f.file_field :attachment, :multiple => true, name: "employee_attachments[attachment][]", :onchange =>"validateFiles(this);", :data => {:max_file_size => 5.megabytes, :error => " Please Choose valid file to attach"}, :required =>true %> 
                <div class="help-block with-errors"></div>  
              </div>
            </div>	

<!---- <span id="add_attachment_field" ></span>
<span id='add_field'><a href="#"><i class="fa fa-icon fa-plus">Add More</i></a> </span>	<br>	<br>---->
          <% end %>
          <div class="form-group">  
            <div class="col-lg-offset-2 col-lg-10">
              <%= f.submit  'Save', :class => "btn btn-success" %>
              <%= link_to 'Cancel', attachment_index_employee_path(@employee), :class => "btn btn-danger", :remote => true %> 
        <% end %>																												
      </div><!--/.module-body-->
    </div><!--/.module-->
  </div>
</div>

<!-- data-error='Please  Attachment file' required><div class='help-block with-errors'></div>                      
data-error='Please Enter Attachment Title' required><div class='help-block with-errors'></div> -->

<script>
  $(".new_attachment_form").validator();
</script>         
<script>
  $(function(){
    $("#add_field").click(function(){
      $("#add_attachment_field").append(
"<span><label class='required'>Attachment Name</label><input class='form-control' id='employee_attachments_attachment_name' name='employee_attachments[attachment_name][]' type='text' ><a onclick='$(this).parent().hide();' class='icon-minus' style='float: right;'></a><br><label class='required'>Upload File</label><input id='employee_attachments_attachment' multiple='multiple' name='employee_attachments[attachment][]' type='file' </span>");
    });  
  });
</script>


<script>
  function validateFiles(inputFile) {
    var maxExceededMessage = "This file exceeds the maximum allowed file size (5 MB)";
    var extErrorMessage = "Only file with extension: .jpg, .jpeg, .gif, .png, .pdf, .ppt, .pptx, .doc, .docx, .zip, .rar, .txt, .xls is allowed";
    var allowedExtension = ["jpg", "LPG", "JPEG", "jpeg", "gif", "GIF",  "png", "PNG",  "doc", "DOC", "docx", "DOCX", "ppt", "PPT", "pptx", "PPTX", "xls", "XLS", "xlsx", "XLSX", "txt", "TXT", "rar", "RAR", "pdf", "PDf", "psd", "PSD"]; 

    var extName;
    var maxFileSize = $(inputFile).data('max-file-size');
    var sizeExceeded = false;
    var extError = false;

    $.each(inputFile.files, function() {
      if (this.size && maxFileSize && this.size > parseInt(maxFileSize)) {sizeExceeded=true;};
      extName = this.name.split('.').pop();
      if ($.inArray(extName, allowedExtension) == -1) {extError=true;};
    }); 
    if (sizeExceeded) {
      window.alert(maxExceededMessage);
      $(inputFile).val('');
    };

    if (extError) {
      window.alert(extErrorMessage);  
      $(inputFile).val('');
    };
  }
</script>






