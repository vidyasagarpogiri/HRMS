
    <div class="row">                                             
      <div class="col-lg-12">
          <div class="panel panel-info">
             <div class="panel-heading">
                <label class="pull-left"><a id="prev" ><i class="icon-chevron-left"></i> Previous Week</a></label>
                <label class="pull-right"><a  id="next">Next Week <i class=" icon-chevron-right"></i></a></label><br>
              </div>                                                                                        
              <div class="panel-body">                                                                          								
                <table class="table table-striped table-bordered table-condensed" id="attendance_table">
								  <thead>
									  <tr>		
  									  <th>Employee Name</th>								    
									    <th class="Mon"><br>Monday</th>									     
                      <th class="Tue"><br>Tuesday</th>
                      <th class="Wed"><br>Wednesday</th>
                      <th class="Thu"><br>Thursday</th>
                      <th class="Fri"><br>Friday</th>
                      <th class="Sat"><br>Saturday</th>
                      <th class="Sun"><br>Sunday</th>                         
									  </tr>
								  </thead>
								  <tbody>
								    <% @employees.each do |employee| %>  
                    <tr id= "<%= employee.id %>">
                      <td><%= employee.full_name%></td>
									    <td class="Mon"></td>
									    <td class="Tue"></td>
									    <td class="Wed"></td>
									    <td class="Thu"></td>
									    <td class="Fri"></td>
									    <td class="Sat"></td>
									    <td class="Sun"></td>
                    </tr>
                    <% end %>                    
								  </tbody>
								</table>
								<input type="hidden" value="0" id="week_num">
              </div><!-- module body-->
            </div>                   
        </div><!--/.span9-->                
     </div><!--/.row-->

<script>
$(function(){

  var i = 0 ;
  call_sw();
  $("#prev").click(function(){
    i -= 1 ;
    $("#week_num").val(i);
    call_sw();
  });
  $("#next").click(function(){
    if(i<=0){
       i += 1 ;
      $("#week_num").val(i);
      call_sw();
    }
  });
});


function call_sw(){
  $("#attendance_table tr td:not(:first-child)").html("0");
  // sekhar - json to get dates and working hours of employees based on week 
  $.getJSON( "/employee_attendence/attandence_ws.json?week_no="+$("#week_num").val(), function( data ) {
    $.each(data, function( key, value ) {
          $("th span").remove();
          // loop for append dates and day value in the table
          $.each(data["dt"], function( dt, v ) {
            $("th."+dt).prepend("<span>"+v+"</span> "); // append day and date to th tag in the table
          });

      var i=0;          
      $.each(value, function( day, hrs ) {
        day_arr = day.split("|"); 
        if(hrs!="0" && hrs.toString().split("hr").length==2){ // if working hours present
          $("tr#"+key+" ."+day_arr[0]).html(hrs+ " <i class='fa fa-comment' onclick='call_log_sw($(this).parent().parent().attr(&#39;id&#39;),&#39;"+data["dt"][day]+"&#39;)'></i>"); // append working hours of corresponding date to table row
        }
        else {
          if((day_arr[0]=="Sat" || day_arr[0]=="Sun") && hrs.toString().split("hr").length!=2){ // for sat and sunday
            $("tr#"+key+" ."+day_arr[0]).text(0); 
          } else 
          {
            $("tr#"+key+" ."+day_arr[0]).text(hrs); 
          }
          
        }
        
        i+=1;
      });
   });
  });
}

// function will be called when we click on comment icon of timings in the table
function call_log_sw(id, val){
  var log_records = ""
  $.get( "/employee_attendence/attendence_log_ws.json?emp_id="+id+"&dt="+val, function( data ) { // json for attendence log i.e timings of in and put of an employee
    $.each(data, function( k, v ) {   
          $(".modal-header h4").html("<i class='icon-time icon-large'></i> Attendance Logs - "+v);
      if(k!="dt"){
      $.each(v, function( key, value ) {   
      //console.log(value[0]);
          in_out = value[1]==true ? "<i class='icon-circle-arrow-down text-success'></i> in" : "<i class='icon-circle-arrow-up text-error '></i> out " ;
          log_records += "<tr><td>"+value[0]+" </td><td> "+ in_out +"</td></tr>";
          $("#show-attendance table#attendance_table tbody").html(log_records);    
       });
       }
     });
  });
  $("#show-attendance").modal('show');
}
</script>




<!-- Modal -->
<div class="modal fade" id="show-attendance" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel"> <i class="icon-time icon-large"></i> Attendance Logs </h4>
      </div>
      <div class="modal-body show-investment-modal-body">
         <table class="table table-striped table-bordered table-condensed" id="attendance_table">
				    <thead>
					    <tr>		
						    <th>Date and Time</th>								    
					      <th>Status</th>									                                                   
					    </tr>
				    </thead>
				    <tbody>
				    </tbody>
				 </table>   
        
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

