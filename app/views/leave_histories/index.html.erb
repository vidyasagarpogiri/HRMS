
<div class="row">
  <% if @employee.group.present? && @employee.group.leave_policy.present? %>
    <% if @employee.reporting_manager? %>
    <aside class="profile-nav col-lg-3">
      <section class="panel">
        <div class="user-heading round">                   
        <a href="#">   
          <%= image_tag "leave-view-icon.jpg" %>
        </a> 
        <p>Available Leaves:  <%= pluralize(Leave.employee_available_leaves(@employee)+0, 'day') %></p>                       
        <p>Used Leaves : <%= pluralize(total_used_leaves(@employee), 'day') %>  </p>
      </div> 
      <ul class="nav nav-pills nav-stacked">            
       <li class="active"><a href="#waiting-for-approval" data-toggle="tab"><i class="fa fa-user"></i>Leaves Waiting for Approval</a></li>
          <li><a href="#upcoming-leaves" data-toggle="tab"><i class="fa fa-user"></i>Upcoming Leaves List</a></li>
          <li ><a href="#leaves-history" data-toggle="tab"><i class="fa fa-user"></i>Leave History</a></li>
          <li><a href="#leave_policy" data-toggle="tab"><i class="fa fa-user"></i>Leave Policy</a></li>
          <li><a href="#holiday_calender" data-toggle="tab"><i class="fa fa-user"></i>Holiday-Calender</a></li>          
       </ul>                                  
      </section>
    </aside> 
    <aside class="profile-info col-lg-9">
      <section>
          <div class="profile-tab-content tab-content">  
          <div class="tab-pane fade active in" id="waiting-for-approval">
            <div class="module">                                              
                <%= render "leave_histories/waiting_for_approvals"%>                  
            </div> 
          </div><!--/.tab-pane-list-->
<!--leaves PANEL-->                                    
          
          <div class="tab-pane fade" id="upcoming-leaves">
            <div class="module">
               <%= render "leave_histories/upcoming_leaves_list"%>
            </div>         
          </div><!--/.tab-pane-list--> 
<!--designations PANEL-->   
           
            <div class="tab-pane fade " id="leaves-history">
              <div class="module"> 
                <%= render "leave_histories/leave_history" %>    
              </div>
            </div> <!--/.tab-pane-list-->                                              
<!--leave_policies PANEL-->             
           
            <div class="tab-pane fade " id="leave_policy">
              <div class="module"> 
                <%= render "leave_histories/leave_policy"%>
              </div>                                          
            </div><!--/.tab-pane-list-->
<!--holiday_calender PANEL-->             
            
            <div class="tab-pane fade " id="holiday_calender">
              <div class="module">  
                <%= render "leave_histories/holiday_list" %>
              </div>                                          
            </div><!--/.tab-pane-list-->                                    
         </div><!--/.profile-tab-content -->                                                                                                                 
        <% else %>
        <section class="wrapper ">
          <div class="panel panel-info">
            <div class="panel-heading">
              My Leaves
            </div> 
            <div class="panel-body">
              <div class="alert alert-success alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                There is No Reporting Manager. Please contact HR.
              </div>
            </div>
          </div>
        </section>                   
        <% end %>
       <% else %>
       <section class="wrapper ">
         <div class="panel panel-info">
           <div class="panel-heading">
              My Leaves
           </div> 
           <div class="panel-body">                    
             <div class="alert alert-success alert-dismissable">
               <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
               There is no leave policy configure to your Group. Please  HR.  
             </div> 
           </div>
         </div> 
       </section>                 
      <% end %>
       </section>
    </aside>                

</div>



<script>
$(function(){
alert("hai");
    $('.half_day').hide();
    $(".alert-message").hide();
     $('.floatingleave').hide();
     
    $('.rb1').click(function(){
      $('.full_day').hide();
      $('.half_day').show();
      $("#half_day").prop('required', true);
      $("#floating_leave").removeAttr("required");
      $("#full_day_from").removeAttr("required");
      $("#full_day_to").removeAttr("required");
    });
    $('.rb2').click(function(){
      $('.half_day').hide();
      $('.full_day').show();
      $("#full_day_from").prop('required', true);
      $("#full_day_to").prop('required', true);
      $("#half_day").removeAttr("required");
      $("#floating_leave").removeAttr("required");
    });
    
    
    var startDate = new Date('01/01/1900');
    var FromEndDate = new Date();
    var ToEndDate = new Date();

    $('.leave-form-date').datepicker({
       format: 'dd/mm/yyyy',
       startDate: new Date(), 
       autoclose: true
    })
     .on('changeDate', function(selected){
           startDate = new Date(selected.date.valueOf());
           startDate.setDate(startDate.getDate(new Date(selected.date.valueOf())));
           $('.leave-to-date').datepicker('setStartDate', startDate);
     });
     
     $('.leave-to-date').datepicker({
           format: 'dd/mm/yyyy',
           autoclose: true
       })
       .on('changeDate', function(selected){
           FromEndDate = new Date(selected.date.valueOf());
           FromEndDate.setDate(FromEndDate.getDate(new Date(selected.date.valueOf())));
           $('.leave-from-date').datepicker('setEndDate', FromEndDate);
       });
       
       
      $(".idnm2").change(function(){
       
        if ($(".rb2").prop("checked")){
          var startDate =$(".idnm1").datepicker("getDate");
          var endDate =$(".idnm2").datepicker("getDate");
          var diff = endDate - startDate;// calculating date difference will give value in milliseconds
          var days = (diff/86400000)+1; // converting milliseconds to days here we are adding 1, becuase it will give the difference of two dates
          var weeks = Math.floor(days / 7); // calculating how many weeks we have in that days
          days = days - (weeks * 2); // multiply with 2 will give how many weekends we have in those weeks
          var startDay = startDate.getDay(); //will give day of that date
          var endDay = endDate.getDay();
          if (startDay - endDay > 1) // conditons for calculating days depends on their start and end dates
            days = days - 2;
          if (startDay == 0 && endDay != 6) // it checks weather start day is sunday
            days = days - 1;
          if (endDay == 6 && startDay != 0) // it checks weather end day is saturday
            days = days - 1;
          var total_leaves = parseFloat($("#total_leaves").val());// converting value into float
          if(total_leaves<days){  // checking weather applied leaves are more than balance leaves
            $(".alert-message").show(); // it will show an alert message to the user that he crossed his balance leaves
          }
          else{
            $(".alert-message").hide();
          }
        }
      });
     
   $('.leave-date').datepicker({
       format: 'dd/mm/yyyy',
        startDate: FromEndDate,
       //endDate: '01/01/2900',
       autoclose: true
   });
   

   
    $('.float-leave-date').datepicker({
       format: 'dd/mm/yyyy',
       startDate: new Date(),
      
       autoclose: true
   })
   
    $(".leave_type").change(function(){
      var leave_id = parseInt($(this).val());
      if(leave_id == 2)
        {
          $('#casualleave').hide();
          $('.floatingleave').show();
          $("#full_day_from").removeAttr("required");
          $("#full_day_to").removeAttr("required");
          $("#floating_leave").prop('required', true);
          $("#half_day").removeAttr("required");
          
          //.datepicker('setDate', date);
        }
        else{
          $('.floatingleave').hide();
          $('#casualleave').show();
          $("#full_day_from").prop('required', true);
          $("#full_day_to").prop('required', true);
          $("#floating_leave").removeAttr("required");
          $("#half_day").removeAttr("required");
        }
          //console.log(leave_id);
     });
     
  
});
</script>







                    
