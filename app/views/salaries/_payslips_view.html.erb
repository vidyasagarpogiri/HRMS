<div class="wrapper">
  <div class="container">
    <div class="row">                                             
      <div class="span12">
        <div class="content">
          <div class="module">
            <div class="module-head" style="background-color: #82B4E6 ">
              <h3>pay slips
              </h3>
            </div>
            <div class="module-body">
              <div class="row-fluid">
                <div class="span6">
                  <%= form_tag(payslips_view_path, method: :get,  :class => "form-horizontal", :remote => true) do %>            
                  <label><strong>Select Month to View payslip :&nbsp&nbsp </strong><br>
                  <select name="payslip_view_year" class="payroll_year">
                    <option value=0>-select year-</option>
                    <% @years.each do |year| %>
                      <option value="<%= year %>"><%= year %></option>
                    <% end %>             
                  </select>
                  <select name="payslip_view_month" class ="payroll_month">
                    <option value=0>-select month-</option>
                  </select>   
                  <input type="submit" class="btn btn-success" value="View">                      
                  <% end %>      
                </div>              
                <div class="span6">  <br> 
                  <% unless @payroll_month == Time.now.month-1 %>      
                    <%= link_to "Generate Last Month PaySlips", payslips_path, :class => "btn btn-success pull-right", method: :post, :remote => true %> 
                  <% end %>               
               </div>
             </div></br>
               <% if @payslips.present? %>                 
                <!-- code for displayin all employees payslips -->  
                <div class="employee_payslip">             
                <table class="table table-striped table-bordered table-condensed">
                   <thead>
                   <tr>
                      <th><strong>PaySlips For <%= Date::MONTHNAMES[@month] %>, <%= @year %></strong></th>
                   </tr>
                   <tr>
                      <th>Employee-Id</th>
                      <th>Name</th>
                      <th>Department</th>
                      <th>Total Working days</th>
                      <th>Basic</th>
                      <th>Gross</th>
                      <th>Total Deductions</th>
                      <th>NetPay</th>
                      <th>Aciton</th>
                    </tr>
                   </thead>
                   <% @payslips.each do |payslip| %>
                   <tbody>
                    <tr>
                      <td><%= payslip.employee.employee_id %></td>
                      <td><%= link_to payslip.employee.full_name, "/payslip/#{payslip.id}" %></td>
                      <td><%= payslip.employee.department.department_name %></td>
                      <td><%= payslip.no_of_working_days%></td>
                      <td><%= payslip.basic_salary%></td>
                       <td><%= payslip.gross_salary %></td>
                      <td><%= payslip.total_deductions %></td>
                      <td><%= payslip.netpay %></td>
                      <td><%= link_to 'Edit', "/payslip/#{payslip.id}/edit", :remote => true %></td>
                   </tbody>
                       <% end %> 
                </table>
                </div> 
                <% else %>
                  <div class="alert alert-success alert-dismissable">
                      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                      No PaySlips To Show with given month and Year
                  </div>
                <% end %>           
              
                <%= link_to "Save&Process", salaries_exporting_payslips_excel_sheet_path(:month => @month, :year => @year, :format => "xlsx"), :class => "btn btn-success pull-right" %>
                <% if @payroll_last.status = CompanyPayrollMaster::Processing %>
                  <%= link_to "Send To Bank", salaries_exporting_payslips_excel_sheet_path(:month => @month, :year => @year, :format => "xlsx"), :class => "btn btn-success pull-right" %>
                <% end %>
                </div><br/>
            </div><!--/.module-->
          
               <!-- div for render edit form -->
               
               <div class="payslip_edit"></div>
               
             <!-- ***** -->
        </div><!--/.content-->                    
      </div><!--/.span9-->                
    </div><!--/.row-->
  </div><!--/.container-->
</div><!--/.wrapper-->
<script>
  $(function(){
    $(".payroll_year").change(function(){
      var year = $(this).val();
      $.getJSON("http://localhost:3000/salaries/get_payroll_years.json?yr="+ year, function(data){
        $.each( data, function(key, val) {
          $(".payroll_month").append( "<option>" + val  + "</option>" );
        });
       });
    });
  });
</script>  

