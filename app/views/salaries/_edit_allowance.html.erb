<div class="module">
			<div class="module-head">
				<h3>Allowance List</h3>
			</div>
			<div class="module-body">
                     <%= form_tag  employee_salary_update_allowance_path(@employee, @salary), :id => "first-form", :remote => true do %>
												<table class="table table-striped table-hover" id="sample-table-2"">
												  <thead>
													  <tr>
															  <th>Allowance</th>
															  <th>Percentage</th>
															  <th>Value</th>
															  <th>Applicable</th>
													  <tr/>
											   </thead>	
											   </tbody>				
										     
                         <% @allownaces.each do |allowance, i| %>
												 <% flag, present_allowance_value, present_allowance_percent = value(allowance.name, @employee_allowances) %>
											   <%= fields_for "allowances[]", allowance do |f| %>   
												   <tr>
                              <td><%= allowance.name %></td>
														  <% if allowance.percentage.present? %>
														      <% if present_allowance_percent == allowance.percentage %>
													          <td><%= allowance.percentage %></td>
													          <td><%= allowance_value(allowance.percentage, @salary.basic_salary) %></td>
													        <% else %>
													          <td><%= allowance.percentage %><i class="icon-asterisk"></i></td>
													          <td><%= allowance_value(allowance.percentage, @salary.basic_salary) %><i class="icon-asterisk"></i></td>
													        <% end %>
													      <% else %>
													          
													            <td>---</td>
													        <% if present_allowance_value == allowance.value %>
													            <td> <%=  allowance.value %></td>
													         <% else %>
													            <td> <%=  allowance.value %><i class="icon-asterisk"></i></td>
													         <% end %>
													      <% end %>
													 <!-- code for checking employee have allowances containing in -->
                              <% if  flag == 1 %>
                                <td><%= check_box_tag 'allowance_ids[]', allowance.id, checked = true, :class => "check_event" %></td>
                              <% else %>
                                <td><%= check_box_tag 'allowance_ids[]', allowance.id , checked = false, :class => "check_event" %></td>
                              <% end %>
												   </tr>
                          <% end %>
											    <% end %> 
								  <%= hidden_field_tag('gross_sal',@salary.gross_salary) %>
                  <%= hidden_field_tag('basic_sal',@salary.basic_salary) %>
                  <%= hidden_field_tag('pf_val',@salary.pf) %>
                  <%= hidden_field_tag('esic_val',@salary.esic) %>
											   
                                    
                      </tbody>          
										</table>
										<div class="alert alert-error alert-dismissable", id="error_message">
                      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                         allowances are more than total salary
                    </div>
										<%= submit_tag "Submit", :class => "btn btn-success pull-right", :id=> "save" %><br/>
										 <% end %> 
     </div>
     <!-- end of module body-->
</div>
<!-- end of module -->


 <!-- Script for gross calculation -->
<script>
$(function(){

    var gross_salary = 0.0;
   var gross = parseFloat($("#gross_sal").val());
   var pf = ($("#pf_val").val());
   var esic = ($("#esic_val").val());
    var basic = $("#basic_sal").val();
  $(".check_event").click(function(){
    gross_check();
  }); 
  gross_check();
  function gross_check(){
    var count = 0.0;
     
    for(var i=0;i<$("input:checkbox:checked").parent().parent().length;i++){
     count += parseFloat($($($("input:checkbox:checked")[i]).parent().parent().find("td")[2]).text());
    }
    gross_salary = parseFloat(basic)+parseFloat(pf)+parseFloat(esic)+count;
   
    if(gross_salary > gross)
    {
      $("#save").prop("disabled",true)
      $("#error_message").show();
    } else {
      $("#save").prop("disabled",false)
      $("#error_message").hide();
    }
  
  }

});
</script> 
