<!-- code for edit employee payslips -->
<table class="table table-striped table-bordered table-condensed">
  <tr>
    <th>Employee-id</th>
    <th>Employee Name</th>
    <th>Department</th>
  </tr>
  <tr>
    <td><%= @payslip.employee.id %></td>
    <td><%= @payslip.employee.full_name %></td>
    <td><%= @payslip.employee.department.department_name %></td>
  </tr>
</table><hr/>           

<%= form_tag("/payroll/#{@payslip.id}", method: :put, :remote => true, :class => "payslip-form form-horizontal row-fluid ") do %>
<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">No.of.Working Days</label>
      <div class="controls">
        <%= text_field_tag :working_days, (params[:working_days] or @payslip.working_days), :class => "working_days" %>
      </div>
    </div>
  </div>
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Arrears</label></th>
        <div class="controls">
          <%= text_field_tag :arrears, @payslip.arrears, :class => "arrears" %>
        </div>      
    </div>
  </div>
</div><hr>

<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Gross Salary</label></th>
        <div class="controls">
          <%= text_field_tag :gross_salary, (@payslip.gross_salary).round(2), :disabled => true %>
        </div>
    </div>
  </div>
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Proffesional Tax</label></th>
        <div class="controls">
          <%= text_field_tag :pt, @payslip.pt, :class => "pt" %>
        </div>        
    </div>
  </div>
</div><hr>

<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Basic Salary </label>
      <div class="controls">
        <%= text_field_tag :basic_salary, (@payslip.basic_salary).round(2), :disabled => true %>
      </div>
      
    </div>
  </div>
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">TDS</label></th>
      <div class="controls">
        <%= text_field_tag :tds, @payslip.tds, :class => "tds" %>
      </div> 
    </div>
  </div>
</div><hr>

<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">     
      <label class="control-label" for="basicinput">PF</label></th>
        <div class="controls">
          <%= text_field_tag :pf, @payslip.pf, :disabled => true %>
        </div>  
    </div>
  </div>
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Total Deductions</label></th>
        <div class="controls">
          <%= text_field_tag :total_deductions, @payslip.total_deductions, :disabled => true %>
        </div>
     
    </div>
  </div>
</div><hr>

<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Esic</label></th>
        <div class="controls">
          <%= text_field_tag :esic, @payslip.esic, :disabled => true %>
        </div>
      
    </div>
  </div>
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Net Pay</label></th>
        <div class="controls">
          <%= text_field_tag :netpay, (@payslip.netpay).round(2), :disabled => true %>
        </div>
    </div>
  </div>
</div><hr>
<div class ="row-fluid">
  <div class="span5">
    <div class="control-group">
      <label class="control-label" for="basicinput">Pay Mode</label></th>
        <div class="controls salary_mode">
          <select name = "mode_value" class = "mode_option">
            <option value="Bank">Bank</option>
            <option value="Cheque">Cheque</option>
          </select>
        </div>
    </div>
  </div>
</div><hr>
<%= hidden_field_tag('mode',@payslip.mode) %>                 
<%= hidden_field_tag('total_working_days',@payslip.no_of_working_days) %>
<% if @payslip_allowances.present? %>
<table class="table table-striped table-bordered table-condensed">
  <thead>
    <tr>
      <th>Allowance</th>
      <th>percentage</th>
      <th>value</th>
    <tr/>
  </thead>	
<tbody>
  
    <% @payslip_allowances.each do |allowance, i| %>
			<%= fields_for "payslip_allowances[]", allowance do |f| %>  
			  <%# raise payslip_allowance.inspect %>
				<tr>
            <td><%= allowance.allowance_name %></td>
					<% if allowance.value.present? %>
					  <td><%= allowance.value %></td>
					  <td><%= (allowance_value(allowance.value, @payslip.basic_salary)).round(2) %></td>
					<% else %>
					  <td>---</td>
					  <td> <%= (allowance.allowance_value).round(2) %></td>
					<% end %>
				</tr>
			 <% end %>
		  <% end %> 
		
   
 </tbody>
</table>
<% else %>
  <div class="alert alert-danger alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
          No Allowances Applicable For This Payslip 
      </div>
<% end %>
<br/>
<%= link_to 'View PayRoll', "/payroll/#{@payslip.id}", :class => "btn btn-success pull-right" %><br/>
<% end %>
  
  
<script>
  $(function(){
    $(".working_days").change(function(){
      $(".payslip-form").submit();
    });
    $(".arrears").change(function(){
      $(".payslip-form").submit();
    });
    $(".pt").change(function(){
      $(".payslip-form").submit();
    });
    $(".tds").change(function(){
      $(".payslip-form").submit();
    });
    $(".mode_option").change(function(){
      $(".payslip-form").submit();
    });
    var mode = $("#mode").val();
    if(mode=="Bank")
      $(".mode_option").val("Bank");
    else
      $(".mode_option").val("Cheque")
  });
</script>          
             

