<h2>From for education </h2>

<%= form_for @education do |f| %>
  Name Of Qualification:<%= f.text_field :specilization %><br/>
  College/University: <%= f.text_field :institute %><br/>
  Starting Year: <%= f.date_field :year_of_admission %>
  Pass Out Year: <%= f.date_field :year_of_pass %><br/>
  Percentage/CGPA: <%= f.text_field :cgpa_percentage %><br/>
  <select id="country_list" name="ed_country">
  </select>
  <input type='text' id='new_country' name='new_country'>
  <span id="state_dpdwn"></span>
  <span id="city_dpdwn"></span>
  
  <%= f.submit %>
 
<% end %>

<script>
  $(function(){
     $("#new_country").hide();
     $("#country_list").append("<option value='0'>Select Country</option>");     
    $.getJSON("/educations/countries.json", function( data ) {
        parseData("country",data);
     } ) ;
     
     add_new_field("country");     
     function states(){
      $("#new_state").hide();
      $("#state_list").append("<option value='0'>Select State</option>");
      $.getJSON("/educations/states.json?country_id="+$("#country_list").val(), function( data ) {
          parseData("state",data);
       } ) ;
       
       add_new_field("state");
     }
     
     function cities(){
      $("#new_city").hide();
      $("#city_list").append("<option value='0'>Select City</option>");
      $.getJSON("/educations/cities.json?state_id="+$("#state_list").val(), function( data ) {
          parseData("city",data);
       } ) ;
       
       add_new_field("city");
     }
     
    function parseData(field_type, data){
      $.each( data, function( key, val ) {
          value = val['id'];
          name = val[""+field_type+"_name"]
          $("#"+field_type+"_list").append("<option value='"+value+"'>"+name+"</option>");
        });
          $("#"+field_type+"_list").append("<option value='other' id='other_"+field_type+"'>Other</option>");
      }
    
    function add_new_field(field_type){
       $("#"+field_type+"_list").change(function(){ 
         if($("#"+field_type+"_list").val()=="other"){
          $("#new_"+field_type+"").show();
         } else {
           $("#new_"+field_type+"").hide();
             if(field_type=="country"){
                 $("#state_dpdwn").html("<select id='state_list' name='ed_state'></select><input type='text' id='new_state' name='new_state'>");
                 states();             
             }
             if(field_type=="state"){
                 $("#city_dpdwn").html("<select id='city_list' name='ed_city'></select><input type='text' id='new_city' name='new_city'>");
                 cities();             
             }
           }
         });
       }     
  });
</script>
